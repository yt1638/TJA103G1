<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>會員系統–我的票券</title>

<link rel="stylesheet" th:href="@{/css/member/member.css}">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
	crossorigin="anonymous">
<link
	href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=LXGW+WenKai+Mono+TC&display=swap"
	rel="stylesheet">

<style>
.ticketCardBody {
    position: relative;
    overflow: hidden;
}

.watermark {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(-25deg);
    font-size: 64px;
    font-weight: 900;
    letter-spacing: 8px;
    opacity: 0.15;
    pointer-events: none;
    z-index: 5;
    white-space: nowrap;
    text-transform: uppercase;
}

/* ===== 已使用 ===== */
.watermark.used {
    color: #d90429;
    border: 6px solid #d90429;
    padding: 12px 16px;
    border-radius: 12px;
}

.watermark.verify {
    color: #f77f00;
    border: 6px dashed #f77f00;
    padding: 12px 16px;
    border-radius: 12px;
}

/* ===== 狀態文字（右上角） ===== */
.status {
    position: absolute;
    top: 0px;
    right: 0px;
    padding: 6px 14px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 20px;
}

.status.used {
    background: #d90429;
    color: #fff;
}

.status.unused {
    background: #2b9348;
    color: #fff;
}

.ticketBarcode form button {
    background: linear-gradient(135deg, #f77f00, #fcbf49);
    border: none;
    color: #fff;
    padding: 6px 16px;
    border-radius: 30px;
    font-size: 16px;
    font-weight: bold;
    box-shadow: 0 1px 1px rgba(0,0,0,.06);
    transition: all .25s ease;
    margin: 20px -16px 20px 0px;
}

.ticketBarcode form button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(0,0,0,.25);
}

.message{
	margin-top: 20px;
}

/* ===== 驗票後動畫效果 ===== */

/* 驗票按鈕淡出 */
.ticketBarcode form {
    transition: opacity .5s ease, transform .5s ease;
}

.ticketBarcode.used form {
    opacity: 0;
    transform: translateY(10px);
    pointer-events: none;
}

/* 已使用浮水印動畫 */
.watermark.used {
    animation: stampUsed .6s ease-out forwards;
    transform-origin: center;
}

/* 蓋章動畫 */
@keyframes stampUsed {
    0% {
        transform: translate(-50%, -50%) scale(3) rotate(-25deg);
        opacity: 0;
    }
    60% {
        transform: translate(-50%, -50%) scale(0.9) rotate(-25deg);
        opacity: .25;
    }
    100% {
        transform: translate(-50%, -50%) scale(1) rotate(-25deg);
        opacity: .18;
    }
}

</style>

</head>
<body>
	<div th:replace="fragments/memberTopNav :: topNav"></div>

	<div class="inner">
		<div th:replace="fragments/memberLeftNav :: sideNav"></div>
		<div class="content ticketContent">
			<h2 class="contentTitle">我的票券</h2>
			<hr>


			<div class="orderDetails" th:if="${order == null}">
				<h5>
					目前沒有任何票券，快去選一部電影，立即訂票吧! <a th:href="@{/order/order}">前往電影列表</a>
				</h5>
			</div>

			<div class="card ticketCard" th:if="${order != null}">
				<h5 class="card-header ticketH5">
					訂單編號: <span th:text="${order.orderId}" class="order orderId"></span>
				</h5>
				<div class="card-body ticketCardBody">
					<div class="left ticketInfo">
						<ul>
							<li><strong>電影: </strong> <span
								th:text="${order.session.movie.nameTw}"></span></li>
							<li><strong>場次: </strong> <span
								th:text="${#dates.format(order.session.startTime, 'yyyy-MM-dd HH:mm')}"
								class="order ordermDate"></span></li>
							<li><strong>票種: </strong> <span
								th:each="ticket : ${order.orderTickets}"
								th:text="${ticket.ticketType == 1 ? '全票' : '優待票'} + ' '"></span>
							</li>
							<li><strong>座位: </strong>
								<ul th:each="ticket : ${order.orderTickets}">
									<li
										th:text="${ticket.seat.rowNo + '排 ' + ticket.seat.columnNo + '號'}"></li>
								</ul></li>
							<li><strong>加購餐飲: </strong>
								<ul th:if="${not #lists.isEmpty(order.orderFoods)}">
									<li th:each="food : ${order.orderFoods}"><span
										th:text="${food.food.foodName}" class="order ordermFood"></span>
										x <span th:text="${food.foodQuantity}"
										class="order ordermFood"></span></li>
								</ul>
								<h6 th:if="${#lists.isEmpty(order.orderFoods)}">未加購餐飲</h6></li>
							<li><strong>訂單金額: </strong> <span
								th:text="${order.totalPrice}" class="order orderAmount"></span></li>
						</ul>

					</div>
					<div class="right ticketBarcode" th:classappend="${order.used} ? 'used'">

						
						<!-- 右上狀態標籤 -->
						<div class="status"
						     th:classappend="${order.used} ? 'used' : 'unused'"
						     th:text="${order.used} ? '票券狀態: 已使用' : '票券狀態: 未使用'">
						</div>
						
						<!-- 浮水印 -->
						<div th:if="${order.used}" class="watermark used">已使用</div>
						<div th:if="${!order.used}" class="watermark verify">請驗票</div>
						
						<!-- 驗票按鈕 -->
						<form th:if="${!order.used}" method="post"
							th:action="@{/member/verify}"
							onsubmit="return confirm('確定要剪票嗎？')">
							<input type="hidden" name="orderId" th:value="${order.orderId}" />
							<button type="submit">剪票</button>
						</form>

<!-- 						<div class="message" th:if="${verifyMessage}" -->
<!-- 							th:text="${verifyMessage}"></div> -->

					</div>

				</div>

				<div th:if="${order != null}"
					class="order-pagination d-flex align-items-center gap-2 mt-4">

					<a class="btn btn-page" th:href="@{/member/memberTicket(page=0)}"
						th:classappend="${currentPage == 0} ? ' disabled' : ''"> 第一筆 </a>

					<a class="btn btn-page"
						th:href="@{/member/memberTicket(page=${currentPage - 1})}"
						th:classappend="${currentPage == 0} ? ' disabled' : ''"> 上一筆 </a>

					<span class="page-info mx-3"> 第 <strong
						th:text="${currentPage + 1}"></strong> / <strong
						th:text="${totalPages > 0 ? totalPages : 1}"></strong>
					</span> <a class="btn btn-page"
						th:href="@{/member/memberTicket(page=${currentPage + 1})}"
						th:classappend="${currentPage + 1 >= totalPages} ? ' disabled' : ''">
						下一筆 </a> <a class="btn btn-page"
						th:href="@{/member/memberTicket(page=${totalPages - 1})}"
						th:classappend="${currentPage + 1 >= totalPages} ? ' disabled' : ''">
						最後一筆 </a>
				</div>

			</div>


		</div>
	</div>



	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
		crossorigin="anonymous"></script>
	<script>
		
	</script>


</body>
</html>