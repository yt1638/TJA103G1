<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>會員系統–我的票券</title>
        
        <link rel="stylesheet" th:href="@{/css/member/member.css}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
        <link
            href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=LXGW+WenKai+Mono+TC&display=swap"
            rel="stylesheet">
        <style>
        	.orderDetails{
                margin: 20px;
            }
            .ticketInfo li strong,span{
            	font-size: 18px;
            }
            .order-pagination {
			    margin-top: 10px;
			    padding-top: 0px;
			    border-top: 1px dashed #ddd;
			    padding-left: 12px;
			    justify-content: flex-start;
    			margin-left: 12px;
			}

			.btn-page {
			    border-radius: 20px;
			    padding: 6px 14px;
			    font-size: 0.9rem;
			    color: #5a5a5a;
			    border: 1px solid #cfcfe8;
			    background-color: #fff;
			    transition: all 0.2s ease;
			}
			
			
			.btn-page:hover:not(.disabled) {
			    background-color: #f0f1ff;
			    color: #3f3d99;
			    border-color: #3f3d99;
			}
			
			
			.btn-page.disabled {
			    color: #aaa;
			    background-color: #f3f3f3;
			    border-color: #ddd;
			
			    opacity: 1;               
			    cursor: not-allowed;      
			    pointer-events: none;     
			
			    box-shadow: inset 0 1px 2px rgba(0,0,0,0.08); 
			}
			
			
			.btn-page.disabled:hover {
			    background-color: #f3f3f3;
			    color: #aaa;
			    border-color: #ddd;
			}

			
			.page-info {
			    font-size: 0.95rem;
			    color: #777;
			}
			.page-info strong {
			    color: #3f3d99;
			}
			ticketInfo li{
				border-bottom: none !important;
				margin-bottom: 10px; 
			}
			ticketInfo li a{
				font-size: 20px;
			}
			.ticketBarcodeImg{
				width: 180px;
				height: 180px;
			}
			.ticketBtn{
				display: block;
				margin: -10px auto;
			}
		
		
        </style>

    </head>
    <body>
        <div th:replace="fragments/memberTopNav :: topNav"></div>
        
        <div class="inner">
            <div th:replace="fragments/memberLeftNav :: sideNav"></div>
            <div class="content ticketContent">
                <h2 class="contentTitle">我的票券</h2>
                <hr>


				<div class="orderDetails" th:if="${order == null}">
				    <h5>目前沒有任何票券，快去選一部電影，立即訂票吧!  <a th:href="@{/order/order}" >前往電影列表</a></h5>
				</div>
				
                <div class="card ticketCard" th:if="${order != null}">
                    <h5 class="card-header ticketH5">訂單編號: <span th:text="${order.orderId}" class="order orderId"></span></h5>
                    <div class="card-body ticketCardBody">
                        <div class="left ticketInfo">
                        	<ul>
	                            <li><strong>電影: </strong> <span th:text="${order.session.movie.nameTw}"></span></li>
	                            <li><strong>場次: </strong> <span th:text="${#dates.format(order.session.startTime, 'yyyy-MM-dd HH:mm')}" class="order ordermDate"></span></li>
	                            <li>
								    <strong>票種: </strong>
								    <span th:each="ticket : ${order.orderTickets}" 
								          th:text="${ticket.ticketType == 1 ? '全票' : '優待票'} + ' '"></span>
								</li>
	                            <li><strong>座位: </strong>
			                        <ul th:each="ticket : ${order.orderTickets}">
			                        	<li th:text="${ticket.seat.rowNo + '排 ' + ticket.seat.columnNo + '號'}"></li>
			                        </ul>
			                    </li>
	                            <li><strong>加購餐飲: </strong>
			                        <ul th:if="${not #lists.isEmpty(order.orderFoods)}">
			                        	<li th:each="food : ${order.orderFoods}">
			                        		<span th:text="${food.food.foodName}" class="order ordermFood"></span> x
			                        		<span th:text="${food.foodQuantity}" class="order ordermFood"></span>
			                        	</li>
			                        </ul>
		                        	<h6 th:if="${#lists.isEmpty(order.orderFoods)}">未加購餐飲</h6>
		                        </li>
		                        <li><strong>訂單金額: </strong> <span th:text="${order.totalPrice}" class="order orderAmount"></span></li>
                            </ul>
                        	
                        </div>
                        <div class="right ticketBarcode">
             
                            <img th:if="${qrCodeBase64 != null}" th:src="'data:image/png;base64,' + ${qrCodeBase64}" alt="票券條碼" class="ticketBarcodeImg">
	                        <button type="button" class="btn btn-primary ticketBtn">取票說明</button>

                        </div>
                        
                    </div>
                    
                    <div th:if="${order != null}"
				     class="order-pagination d-flex align-items-center gap-2 mt-4">
				
				    <a class="btn btn-page"
				       th:href="@{/member/memberTicket(page=0)}"
				       th:classappend="${currentPage == 0} ? ' disabled' : ''">
				       第一筆
				    </a>
				
				    <a class="btn btn-page"
				       th:href="@{/member/memberTicket(page=${currentPage - 1})}"
				       th:classappend="${currentPage == 0} ? ' disabled' : ''">
				       上一筆
				    </a>
				
				    <span class="page-info mx-3">
				        第 <strong th:text="${currentPage + 1}"></strong>
				        / <strong th:text="${totalPages > 0 ? totalPages : 1}"></strong>
				    </span>
				
				    <a class="btn btn-page"
				       th:href="@{/member/memberTicket(page=${currentPage + 1})}"
				       th:classappend="${currentPage + 1 >= totalPages} ? ' disabled' : ''">
				        下一筆
				    </a>
				
				    <a class="btn btn-page"
				       th:href="@{/member/memberTicket(page=${totalPages - 1})}"
				       th:classappend="${currentPage + 1 >= totalPages} ? ' disabled' : ''">
				        最後一筆
				    </a>
				</div>
                    
                </div>
                
                
            </div>
        </div>



        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
        <script>
        	let ticketBtn = document.querySelector(".ticketBtn");
        	ticketBtn.addEventListener("click", function(){
        		alert("請於開演前至「自助機台」或「取票櫃台」掃描「取票條碼」，換取實體票券（包含電影票與餐飲券）。若有加購餐飲的貴賓，再請持餐飲券至餐飲櫃台取餐。")
        	})
        </script>
        
            
    </body>
</html>