<div th:fragment="content">
  <style>
    .page-title{
      font-size: 30px;
      font-weight: 800;
      color:#2f3b4a;
      margin: 10px 0 18px;
    }

    .tag-title{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background:#e5e5e5;
      color:#6b6b6b;
      font-weight:700;
      padding:14px 16px;
      border-radius:4px;
      min-width:260px;
    }

    .btn-black{
      background:#111;
      color:#fff;
      border:1px solid #111;
      padding:12px 16px;
      border-radius:4px;
      font-weight:700;
    }
    .btn-black:hover{ filter:brightness(.95); }

    .btn-black-sm{
      background:#111;
      color:#fff;
      border:1px solid #111;
      padding:8px 14px;
      border-radius:4px;
      font-weight:700;
      font-size:14px;
    }
    .btn-black-sm:hover{ filter:brightness(.95); }

    .msg-box{
      margin-top:10px;
      border:1px solid #d9d9d9;
      border-radius:5px;
      background:#fff;
      padding: 0;
    }
    .msg-textarea{
      width:100%;
      min-height:150px;
      border:0;
      outline:0;
      resize: vertical;
      padding:14px 14px;
      font-size:18px;
      line-height:1.7;
      color:#2f3b4a;
    }
    .msg-textarea::placeholder{
      color:#9aa4b2;
      font-weight:600;
    }

    /* 下方左右兩欄灰區塊 */
    .schedule-box{
      margin-top:16px;
      background:#ededed;
      border-radius:12px;
      padding:18px 22px;
      max-width:900px;
      display:flex;
      gap:40px;
      flex-wrap:wrap;
    }
    .schedule-col{
      flex:1 1 360px;
      min-width:360px;
    }
    .schedule-title{
      font-weight:700;
      color:#7a7a7a;
      margin-bottom:12px;
      font-size:16px;
    }
    .schedule-row{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .schedule-row select{
      min-width:240px;
      height:44px;
      border:1px solid #cfcfcf;
      border-radius:6px;
      padding:0 12px;
      background:#fff;
      font-size:16px;
      color:#4b5563;
      font-weight:700;
    }
    .unit{
      font-weight:900;
      color:#7a7a7a;
      font-size:18px;
    }

    .error{
      color:#d60000;
      font-weight:800;
      margin-top:8px;
      display:block;
    }
  </style>

  <div class="container-fluid">

    <div class="page-title">喜好通知編輯</div>

    <form id="prefForm"
          th:action="@{/notification_preference/update}"
          method="post"
          th:object="${notificationPreferenceVO}">

      <!-- 保留你原本要更新的欄位：畫面不顯示但會一起送出 -->
      <!-- ⚠️ 這兩個欄位你原本寫 th:field="*{movie}"、"*{member}" 很可能綁錯
           通常應該是 *{movie.movieId} / *{member.memberId}，先照你資料結構調整 -->
      <input type="hidden" th:field="*{movie.movieId}">
      <input type="hidden" th:field="*{member.memberId}">
      <input type="hidden" th:field="*{notiPrefStime}">
      <input type="hidden" th:field="*{notiPrefStat}">

      <!-- 灰色標籤 + 右上立即發送 -->
      <div class="d-flex align-items-center justify-content-between" style="gap:12px;">
        <div class="tag-title">
          <span>喜好通知:</span>
          <i class="fas fa-pen"></i>
        </div>

        <button class="btn-black" type="submit" name="mode" value="sendNow">立即發送</button>
      </div>

      <!-- 內容（大 textarea） -->
      <div class="msg-box">
        <textarea class="msg-textarea"
                  th:field="*{notiPrefScon}"
                  onclick="hideContent('notiPrefScon.errors');"
                  placeholder="親愛的用戶您好：&#10;此封訊息為依據您的喜好，所發送推薦電影..."></textarea>
      </div>

      <span th:if="${#fields.hasErrors('notiPrefScon')}"
            th:errors="*{notiPrefScon}"
            class="error"
            id="notiPrefScon.errors"></span>

      <!-- 下方灰色左右兩欄 -->
      <div class="schedule-box">

        <!-- 左欄：預先發送時間（天） -->
        <div class="schedule-col">
          <div class="schedule-title">設定預先發送時間:</div>

          <div class="schedule-row">
            <select name="advanceDays">
              <option value="" selected>請選擇天數</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="5">5</option>
              <option value="7">7</option>
            </select>

            <span class="unit">天</span>

            <button class="btn-black-sm" type="submit" name="mode" value="schedule">
              確認
            </button>
          </div>
        </div>

        <!-- 右欄：會員信箱（DB） -->
        <div class="schedule-col">
          <div class="schedule-title">選擇會員信箱:</div>

          <div class="schedule-row">
            <select name="memberEmail">
              <option value="" selected>請選擇會員信箱</option>

              <!-- ✅ 需 Controller 丟 memberList -->
              <option th:each="m : ${memberList}"
                      th:value="${m.email}"
				      th:text="${m.email}">
              </option>
            </select>

            <button class="btn-black-sm" type="submit" name="mode" value="sendToMember">
              確認
            </button>
          </div>
        </div>

      </div>

    </form>
  </div>

  <script>
    function hideContent(id){
      const el = document.getElementById(id);
      if(el) el.style.display = "none";
    }
  </script>
</div>
