<div th:fragment = "content">
    <style>

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f3c88;
            display: inline-block;
            border-bottom: 2px solid #1f3c88;
            padding-bottom: 4px;
            margin-bottom: 18px;
        }

        .page-title-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .edit-showstart-btn {
            background-color: #000;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .edit-showstart-btn:hover {
            background-color: #333;
            transform: translateY(-1px);
        }

        /* 灰底查詢區 */
        .search-bar-wrapper {
            background: #e9eaec;
            border-radius: 10px;
            padding: 18px 24px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-group {
            display: flex;
            align-items: center;
            margin-right: 40px;
            margin-bottom: 10px;
        }

        .search-group label {
            margin-right: 8px;
            white-space: nowrap;
            font-weight: 600;
            color: #333;
        }

        .search-group input,
        .search-group select {
            min-width: 210px;
        }

        .search-submit {
            margin-left: auto;
            margin-bottom: 10px;
        }

        .search-submit .btn {
            padding: 6px 26px;
            border-radius: 20px;
        }

        .error-msg {
            color: red;
            font-weight: 700;
            margin-top: 10px;
            margin-bottom: 0;
        }

        /* ✅ DataTables 外觀微調：跟 SB Admin 融合 */
        .dataTables_wrapper {
            padding: 16px;
        }

        table.dataTable thead th {
            text-align: center;
            background-color: #f5f5f5;
        }

        table.dataTable tbody td {
            text-align: center;
            vertical-align: middle;
        }

        /* 內容欄位過長時處理 */
        .td-content {
            max-width: 380px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 修改按鈕：黑底白字 */
		.btn-edit {
		    padding: 6px 14px;
		    border-radius: 10px;
		    border: none;
		    background: #000;      /* 黑底 */
		    color: #fff;           /* 白字 */
		    font-weight: 600;
		    cursor: pointer;
		    transition: all 0.2s ease;
		}
		
		.btn-edit:hover {
		    background: #333;      /* hover 微亮 */
		    color: #fff;
		}

        /* 搜尋按鈕：黑底白字 */
		.search-btn {
		    background-color: #000 !important;
		    color: #fff !important;
		    border: none;
		    padding: 8px 26px;
		    border-radius: 999px;
		    font-weight: 600;
		    transition: all 0.2s ease;
		}
		
		.search-btn:hover {
		    background-color: #333 !important;
		    color: #fff !important;
		    transform: translateY(-1px);
		}
		
		.search-btn:active {
		    background-color: #111 !important;
		}
        
    </style>

        <hr class="sidebar-divider d-none d-md-block">

        <div class="text-center d-none d-md-inline">
            <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>

        <div class="sidebar-card d-none d-lg-flex">
            <img class="sidebar-card-illustration mb-2" src="/img/undraw_rocket.svg" alt="...">
        </div>
    </ul>
    <!-- End Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <div id="content">

            <!-- End Topbar -->

            <div class="container-fluid">

                <div class="page-title-bar">
                    <span class="page-title">喜好通知查詢</span>

                    <button class="edit-showstart-btn" onclick="location.href='/notification_preference/select_page'">
					    喜好通知編輯
					</button>

                </div>

                <!-- ✅ 前端錯誤訊息 -->
                <div id="clientError" class="error-msg"></div>

                <!-- ✅ 複合查詢 -->
                <form method="post"
                      action="/notification_preference/listNotificationPreferences_ByCompositeQuery"
                      onsubmit="return validateForm();">

                    <input type="hidden" name="notiPreftNo" value="">

                    <div class="search-bar-wrapper">
                        <div class="search-group">
                            <label for="sendDate">已發送日期查詢:</label>
                            <input type="date" class="form-control" id="sendDate" name="notiPrefStime">
                        </div>

                        <div class="search-group">
                            <label for="memberId">選擇會員編號:</label>
                            <input type="text" class="form-control" id="memberId" name="memberId" placeholder="請輸入會員編號">
                        </div>

                        <div class="search-group">
                            <label for="movieId">選擇電影編號:</label>
                            <input type="text" class="form-control" id="movieId" name="movieId" placeholder="請輸入電影編號">
                        </div>

                        <div class="search-submit">
                            <button type="submit" class="btn search-btn">搜尋</button>
                        </div>
                    </div>
                </form>

	<table id="example" class="display" style="width: 100%">
	  <thead >
		<tr style="background-color:#CCCCFF">
			<th>會員編號</th>
			<th>電影編號</th>
			<th>發送日期</th>
			<th>發送內容</th>
			<th>發送狀態</th>
		</tr>
	  </thead>
		
	  <tbody>
			<th:block th:each="notificationPreferenceVO : ${notificationPreferenceListData}">
				<tr>
					<td th:text="${notificationPreferenceVO.member.memberId}"></td>
					<td th:text="${notificationPreferenceVO.movie.movieId}"></td>
					<td th:text="${notificationPreferenceVO.notiPrefStime}"></td>
					<td th:text="${notificationPreferenceVO.notiPrefScon}"></td>
					<td th:text="${notificationPreferenceVO.notiPrefStat}"></td>

				</tr>
			</th:block>
  </tbody>
</table>
</div><!-- container-fluid -->
       

<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>



<script>
$(document).ready(function () {
  $('#example').DataTable({
    lengthChange: false,

    searching: false,

    paging: true,
    ordering: true,

    dom: 'rtip',

    language: {
      zeroRecords: "沒有符合的結果",
      emptyTable: "查無資料",
      info: "顯示第 _START_ 至 _END_ 筆結果，共 _TOTAL_ 筆",
      infoEmpty: "顯示第 0 至 0 筆結果，共 0 筆",
      paginate: {
        first: "第一頁",
        previous: "上一頁",
        next: "下一頁",
        last: "最後一頁"
      }
    }
  });
});
</script>

<script>
    function validateForm() {
        const memberId = document.querySelector("[name='memberId']").value.trim();
        const movieId = document.querySelector("[name='movieId']").value.trim();
        const date = document.querySelector("[name='notiPrefStime']").value.trim();

        let errors = [];

        if (!memberId && !movieId && !date) {
            errors.push("請至少輸入一個查詢條件");
        }

        const numberPattern = /^\d+$/;

        if (memberId && !numberPattern.test(memberId)) {
            errors.push("會員編號必須為數字");
        }

        if (movieId && !numberPattern.test(movieId)) {
            errors.push("電影編號必須為數字");
        }

        const errorDiv = document.getElementById("clientError");
        errorDiv.innerHTML = "";

        if (errors.length > 0) {
            errorDiv.innerHTML = errors.join("<br>");
            return false;
        }

        return true;
    }
</script>

</div>
