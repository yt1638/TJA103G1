<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title th:text="${foodVO.foodId == null ? '新增餐點' : '修改餐點'}">餐飲管理</title>
<style>
    body {
        font-family: "微軟正黑體", sans-serif;
        background-color: #f4f7f6;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }
    .form-container {
        background-color: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 600px;
    }
    h2 {
        color: #333;
        text-align: center;
        margin-bottom: 25px;
        border-bottom: 2px solid #f8abb2;
        padding-bottom: 10px;
    }
    .form-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
        color: #555;
    }
    input[type="text"], input[type="number"], select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box; /* 確保 padding 不會撐開寬度 */
    }
    .image-preview {
        width: 100%;
        max-width: 200px;
        height: auto;
        margin-top: 10px;
        border: 1px dashed #ccc;
        border-radius: 5px;
        display: block;
    }
    .btn-container {
        display: flex;
        justify-content: space-between;
        margin-top: 25px;
    }
    .btn-submit {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 30px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }
    .btn-cancel {
        background-color: #6c757d;
        color: white;
        text-decoration: none;
        padding: 10px 30px;
        border-radius: 5px;
        font-weight: bold;
    }
    .error { color: red; font-size: 0.8rem; margin-top: 5px; }
</style>
</head>
<body>

<div class="form-container">
    <h2 th:text="${foodVO.foodId == null ? '新增餐點品項' : '修改餐點品項'}">表單</h2>

    <form th:action="${foodVO.foodId == null ? '/food/insert' : '/food/update'}" 
          method="post" th:object="${foodVO}" enctype="multipart/form-data">
        
        <input type="hidden" th:field="*{foodId}" />

        <div class="form-group">
            <label>餐點名稱：</label>
            <input type="text" th:field="*{foodName}" placeholder="請輸入餐點名稱" />
            <div class="error" th:if="${#fields.hasErrors('foodName')}" th:errors="*{foodName}"></div>
        </div>

        <div class="form-group">
            <label>餐點種類：</label>
            <select name="foodCategoryId">
                <option th:each="cate : ${foodCateList}" 
                        th:value="${cate.foodCategoryId}"
                        th:text="${cate.categoryName}"
                        th:selected="${foodVO.foodCate != null && cate.foodCategoryId == foodVO.foodCate.foodCategoryId}">
                </option>
            </select>
        </div>

        <div class="form-group">
            <label>原價：</label>
            <input type="number" th:field="*{foodOriginalPrice}" step="1" min="0"/>
            <div class="error" th:if="${#fields.hasErrors('foodOriginalPrice')}" th:errors="*{foodOriginalPrice}"></div>
        </div>

        <div class="form-group">
            <label>網路售價：</label>
            <input type="number" th:field="*{foodPrice}" step="1" min="0" />
            <div class="error" th:if="${#fields.hasErrors('foodPrice')}" th:errors="*{foodPrice}"></div>
        </div>

        <div class="form-group">
            <label>狀態：</label>
            <select th:field="*{foodStatus}">
                <option value="1">上架</option>
                <option value="0">下架</option>
            </select>
        </div>

        <div class="form-group">
            <label>餐點圖片：</label>
            <input type="file" name="imageFile" id="imageInput" onchange="previewImage(this)" />
            
            <div th:if="${foodVO.foodId != null && foodVO.foodImage != null}">
                <p style="font-size: 0.8rem; color: #888;">目前圖片：</p>
                <img th:src="@{/foodImageStreamer(foodId=${foodVO.foodId})}" class="image-preview" id="preview" />
            </div>
            <img th:if="${foodVO.foodId == null}" src="" class="image-preview" id="preview" style="display:none;" />
        </div>

        <div class="btn-container">
            <a th:href="@{/food/}" class="btn-cancel">取消回列表</a>
            <button type="submit" class="btn-submit" th:text="${foodVO.foodId == null ? '確認新增' : '確認修改'}">送出</button>
        </div>
    </form>
</div>

<script>
    // 圖片即時預覽功能
    function previewImage(input) {
        var preview = document.getElementById('preview');
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

</body>
</html>