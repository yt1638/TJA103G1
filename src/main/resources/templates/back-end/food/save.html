<div th:fragment="content">
<style>
    /* 1. åŸºç¤ä½ˆå±€å„ªåŒ– - ç§»é™¤ body å¼·åˆ¶å±…ä¸­ */
    .food-form-wrapper {
        width: 100%;
        display: flex;
        justify-content: center; /* è®“è¡¨å–®åœ¨å¯¬è¢å¹•ä¸‹å±…ä¸­ï¼Œä½†ä¸æœƒé™åˆ¶å®¹å™¨å¯¬åº¦ */
        padding-bottom: 3rem;
    }

    .form-card {
        background-color: white;
        padding: 0;
        border-radius: 12px;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        width: 100%;
        max-width: 700px; /* è¡¨å–®ä¸éœ€è¦å¤ªå¯¬ï¼Œå¢åŠ é–±è®€æ€§ */
        border: none;
        overflow: hidden;
    }

    /* æ¨™é¡Œå€å¡Šå„ªåŒ– */
    .form-header {
        background-color: #f8abb2;
        padding: 1.5rem;
        text-align: center;
        border-bottom: 1px solid #eccbcd;
    }

    .form-header h2 {
        color: #333;
        margin: 0;
        font-weight: bold;
        font-size: 1.5rem;
    }

    .form-body {
        padding: 2rem;
    }

    /* æ¬„ä½æ¨£å¼ */
    .form-group {
        margin-bottom: 1.25rem;
    }

    .form-group label {
        font-weight: bold;
        color: #4e73df;
        margin-bottom: 0.5rem;
        display: block;
    }

    /* åœ–ç‰‡é è¦½å€ç¾åŒ– */
    .image-preview-container {
        margin-top: 10px;
        padding: 10px;
        border: 2px dashed #d1d3e2;
        border-radius: 8px;
        background-color: #f8f9fc;
        text-align: center;
        min-height: 100px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .image-preview {
        max-width: 100%;
        max-height: 250px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        display: block;
    }

    .no-image-text {
        color: #858796;
        font-size: 0.9rem;
    }

    /* æŒ‰éˆ•å®¹å™¨ */
    .btn-container {
        display: flex;
        justify-content: space-between;
        gap: 15px;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid #e3e6f0;
    }

    /* éŒ¯èª¤è¨Šæ¯ */
    .error-text {
        color: #e74a3b;
        font-size: 0.85rem;
        margin-top: 5px;
        font-weight: bold;
    }
</style>

<div class="food-form-wrapper">
    <div class="form-card">
        <div class="form-header">
            <h2 th:text="${foodVO.foodId == null ? 'â• æ–°å¢é¤é»å“é …' : 'ğŸ“ ä¿®æ”¹é¤é»å“é …'}">è¡¨å–®æ¨™é¡Œ</h2>
        </div>

        <div class="form-body">
            <form th:action="${foodVO.foodId == null ? '/food/insert' : '/food/update'}" 
                  method="post" th:object="${foodVO}" enctype="multipart/form-data">
                
                <input type="hidden" th:field="*{foodId}" />

                <div class="form-group">
                    <label>é¤é»åç¨± <span class="text-danger">*</span></label>
                    <input type="text" th:field="*{foodName}" class="form-control" placeholder="è«‹è¼¸å…¥é¤é»åç¨±" />
                    <div class="error-text" th:if="${#fields.hasErrors('foodName')}" th:errors="*{foodName}"></div>
                </div>

                <div class="form-group">
                    <label>é¤é»ç¨®é¡</label>
                    <select name="foodCategoryId" class="form-control">
                        <option th:each="cate : ${foodCateList}" 
                                th:value="${cate.foodCategoryId}"
                                th:text="${cate.categoryName}"
                                th:selected="${foodVO.foodCate != null && cate.foodCategoryId == foodVO.foodCate.foodCategoryId}">
                        </option>
                    </select>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>åŸåƒ¹</label>
                            <div class="input-group">
                                <input type="number" th:field="*{foodOriginalPrice}" class="form-control" step="1" min="0"/>
                                <div class="input-group-append"><span class="input-group-text">å…ƒ</span></div>
                            </div>
                            <div class="error-text" th:if="${#fields.hasErrors('foodOriginalPrice')}" th:errors="*{foodOriginalPrice}"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>ç¶²è·¯å”®åƒ¹ <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="number" th:field="*{foodPrice}" class="form-control" step="1" min="0" />
                                <div class="input-group-append"><span class="input-group-text">å…ƒ</span></div>
                            </div>
                            <div class="error-text" th:if="${#fields.hasErrors('foodPrice')}" th:errors="*{foodPrice}"></div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>ä¸Šæ¶ç‹€æ…‹</label>
                    <select th:field="*{foodStatus}" class="form-control">
                        <option value="1">âœ… ä¸Šæ¶ä¸­</option>
                        <option value="0">âŒ ä¸‹æ¶</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>é¤é»åœ–ç‰‡</label>
                    <div class="custom-file mb-2">
                        <input type="file" name="imageFile" class="custom-file-input" id="imageInput" onchange="previewImage(this)" accept="image/*">
                        <label class="custom-file-label" for="imageInput">é¸æ“‡æª”æ¡ˆ...</label>
                    </div>
                    
                    <div class="image-preview-container">
                        <div th:if="${foodVO.foodId != null && foodVO.foodImage != null}" id="currentImageGroup">
                            <p class="small text-muted mb-1">ç›®å‰åœ–ç‰‡é è¦½ï¼š</p>
                            <img th:src="@{/food/imageReader(foodId=${foodVO.foodId})}" class="image-preview" id="preview" />
                        </div>
                        
                        <img th:if="${foodVO.foodId == null}" src="" class="image-preview" id="preview" style="display:none;" />
                        <span th:if="${foodVO.foodId == null}" id="noImageText" class="no-image-text">å°šæœªé¸æ“‡åœ–ç‰‡</span>
                    </div>
                </div>

                <div class="btn-container">
                    <a th:href="@{/food/}" class="btn btn-secondary px-4 shadow-sm">
                        <i class="fas fa-arrow-left mr-1"></i> è¿”å›åˆ—è¡¨
                    </a>
                    <button type="submit" class="btn btn-primary px-5 shadow-sm" th:text="${foodVO.foodId == null ? 'ç¢ºèªæ–°å¢' : 'å„²å­˜ä¿®æ”¹'}">
                        é€å‡º
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function previewImage(input) {
        var preview = document.getElementById('preview');
        var noImageText = document.getElementById('noImageText');
        var fileName = input.files[0].name;
        
        // æ›´æ–° Bootstrap è‡ªå®šç¾©æª”æ¡ˆæ¨™ç±¤æ–‡å­—
        var label = input.nextElementSibling;
        label.innerText = fileName;

        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                if(noImageText) noImageText.style.display = 'none';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

</div>